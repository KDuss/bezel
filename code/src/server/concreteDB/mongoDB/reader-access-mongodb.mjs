import { getDB } from './db.mjs';

const mongodbReader = {};
/**
 * Creates an id field in each document containing the string value
 * of the _id field of the type ObjectId().
 * The _id field is generated by mongoDB automatically at the time a dataset is read into the DB.
 * And is unique for each collection.
 */
mongodbReader.createIds = async () => {
    const found = await getDB().find({ id: { $exists: true } }).toArray();

    if (found.length === 0) {
        getDB().find().forEach(document => {
            const id = document._id;
            const idString = id.toString();
            getDB().updateOne({ _id: id }, { $set: { id: idString } });
        });

        return true;
    }
    return false;
};

/**
 * Creates an index for all columns passed to the function
 * @param {string[]} columns
 * @returns {boolean}
 */
mongodbReader.createColumnIndexes = async columns => {
    columns.map(column => getDB().createIndex(column));
    return true;
};

export default mongodbReader;
